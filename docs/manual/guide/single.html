<html>
    <head>
        <title>Flex Plugin 0.4 - Reference Documentation</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Style" charset="utf-8"/>
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    </head>
    <body class="body">
        <div id="header">
            <div class="images"><br/><br/>
                <a href="http://grails.org" target="_blank"><img alt="The Grails Framework" src="../img/grails.png" border="0"/></a>
                <span style="right:30px; top:20px; position:absolute;">
                    <a href="../index.html" target="_top">Frames</a> | <a href="index.html" target="_top">No Frames</a><br/><br/>
                    <a href="http://springsource.com" target="_blank"><img alt="SpringSource - A Division of VMware" src="../img/springsource-logo.png" border="0"/></a>
                </span>
            </div>
            <div class="message">flex</div>
            <h1>Flex Plugin - Reference Documentation</h1>
            <p><strong>Authors:</strong> Burt Beckwith</p>
            <p><strong>Version:</strong> 0.4</p>
            <em></em>
        </div>

        <div id="toc">
            <h2>Table of Contents</h2>
            <div class="tocItem" style="margin-left:0px"><a href="#1 Introduction to the Flex Plugin">1 Introduction to the Flex Plugin</a></div><div class="tocItem" style="margin-left:10px"><a href="#1.1 Getting Started">1.1 Getting Started</a></div><div class="tocItem" style="margin-left:0px"><a href="#2 Configuration">2 Configuration</a></div><div class="tocItem" style="margin-left:0px"><a href="#3 General Usage">3 General Usage</a></div><div class="tocItem" style="margin-left:0px"><a href="#4 Tutorial">4 Tutorial</a></div>
        </div>
        <div id="content">
            <h1><a name="1 Introduction to the Flex Plugin">1 Introduction to the Flex Plugin</a></h1>The Flex plugin makes it easier to build Grails-powered Rich Internet Applications using <a href="http://www.adobe.com/devnet/flex/" target="blank">Adobe Flex</a> as the front-end client. It depends on the <a href="http://grails.org/plugin/blazeds" target="blank">Blaze DS</a> plugin which configures <a href="http://opensource.adobe.com/wiki/display/blazeds/BlazeDS/" target="blank">Adobe BlazeDS</a> to provide remoting and messaging as well as the <a href="http://grails.org/plugin/spring-security-core" target="blank">Spring Security Core</a> plugin to secure your application.<p class="paragraph"/>In development mode you edit MXML and ActionScript files which get compiled into .swf files and support reloading without needing to restart (just like GSPs). When building a war for production deployment your MXML files get precompiled for performance.<p class="paragraph"/><h1>Plugin version history</h1><p class="paragraph"/><h4>0.4 (November 11, 2010)</h4>
<ul class="star">
<li>Completely rewritten</li>
<li>Depends on the BlazeDS plugin</li>
<li>Depends on the Spring Security Core plugin to provide support for Spring Security 3</li>
<li>Uses Spring Flex version 1.5</li>
</ul><p class="paragraph"/><h4>0.2 (March 6, 2008)</h4>
<ul class="star">
<li>Upgraded to BlazeDS release</li>
<li>Destination name is now configurable (GRAILSPLUGINS-226)</li>
</ul><p class="paragraph"/><h2><a name="1.1 Getting Started">1.1 Getting Started</a></h2><h4>The first step is installing the plugin:</h4><p class="paragraph"/><div class="code"><pre>grails install&#45;plugin flex</pre></div><p class="paragraph"/>This will transtitively install the <a href="http://grails.org/plugin/blazeds" target="blank">BlazeDS</a>, <a href="http://grails.org/plugin/spring-security-core" target="blank">Spring Security Core</a>, and <a href="http://grails.org/plugin/spring-security-acl" target="blank">Spring Security ACL</a> plugins. Refer to the documentation for these plugins for configuration options. At a minimum you'll need to run the <code>s2-quickstart</code> script to configure Spring Security Core, e.g.<p class="paragraph"/><div class="code"><pre>grails s2&#45;quickstart com.yourcompany.yourapp User Role</pre></div><p class="paragraph"/>The BlazeDS and Spring Security ACL plugins have no required initialization steps.<p class="paragraph"/><h4>The next step is configuring the Flex plugin:</h4><p class="paragraph"/>You either need to have a <code>FLEX_HOME</code> environment variable set, or set the <code>grails.plugin.flex.home</code> property in <code>grails-app/conf/Config.groovy</code>. This must point at the location of a Flex SDK, e.g.<p class="paragraph"/><div class="code"><pre>grails.plugin.flex.home = 'c:/devtools/flex'</pre></div><p class="paragraph"/>Once that's configured, run the <a href="../ref/Scripts/flex-init.html" class="Scripts">flex-init</a> script to copy the required development files to your project (in the <code>web-app/WEB-INF/flex</code> folder):<p class="paragraph"/><div class="code"><pre>grails flex&#45;init</pre></div><p class="paragraph"/><h1><a name="2 Configuration">2 Configuration</a></h1>There are several configuration options for the plugin, but most are related to mxml compilation and html wrapper file generation.<p class="paragraph"/><h4>Core properties</h4><p class="paragraph"/>There are only two 'core' properties and only one is required - <code>grails.plugin.flex.home</code> - and only if the <code>FLEX_HOME</code> environment variable is not set.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>grails.plugin.flex.home</td><td>none, must be set</td><td>Location of your Flex SDK</td></tr><tr class="table-even"><td>grails.plugin.flex.webtier.compiler.enabled</td><td><code>true</code> in development</td><td>whether the webtier MXML compiler is enabled</td></tr></table><p class="paragraph"/><h4>MXMLC properties</h4><p class="paragraph"/>There are also several properties that configure mxml compilation, both automatic precompilation when building a war file and explicit compilation when running the <a href="../ref/Scripts/compile-mxml.html" class="Scripts">compile-mxml</a> script.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>grails.plugin.flex.precompileMxml.enabled</td><td><code>false</code></td><td>Set to <code>true</code> to precompile mxml files to swf files when creating a war</td></tr><tr class="table-even"><td>grails.plugin.flex.precompileMxml.files</td><td>none</td><td>A list of file names (relative to the <code>web-app</code> folder) to precompile</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.keepGenerated</td><td><code>false</code></td><td>Set to <code>true</code> keep the files generated by the compiler</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.extraSourcePaths</td><td>none</td><td>A list of extra source paths</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.extraLibPaths</td><td>none</td><td>A list of extra library paths</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.compileTimeConstants</td><td>none</td><td>A map of compile-time constants</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.contextRoot</td><td>application name</td><td>The context root of the web application, used to calculate AMF channel URLs</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.incremental</td><td><code>false</code></td><td>When incremental compilation is enabled, the compiler inspects changes to the bytecode between revisions and only recompiles the section of bytecode that has changed.</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.debug</td><td><code>false</code></td><td>If <code>true</code> generates a debug SWF file which includes line numbers and filenames of all source files.</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.verboseStacktraces</td><td><code>false</code></td><td>If <code>true</code> generates source code that includes line numbers for display in stacktraces when a runtime error occurs.</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.actionscriptFileEncoding</td><td>none</td><td>Sets the .as file encoding so that the compiler correctly interprets ActionScript files.</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.accessible</td><td><code>false</code></td><td>Enables accessibility features</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.headless</td><td><code>false</code></td><td>Enables the headless implementation of the Flex compiler; required to use fonts and SVG on UNIX systems without X Windows.</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.optimize</td><td><code>true</code></td><td>Enables the ActionScript optimizer which reduces file size and increases performance by optimizing the SWF file's bytecode.</td></tr></table><p class="paragraph"/><h4>HTML wrapper properties</h4><p class="paragraph"/>The remaining properties configure the generation of an html wrapper to load a swf file.<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.htmlWrapper.create</td><td><code>false</code></td><td>if <code>true</code> then an html wrapper file will be created when precompiling</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.htmlWrapper.title</td><td>MXML file name</td><td>The HTML title tag value</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.htmlWrapper.extension</td><td>gsp</td><td>The extension for the html file</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.htmlWrapper.history</td><td><code>false</code></td><td>If true creates resources for history tracking</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.htmlWrapper.height</td><td><code>100%</code></td><td>The height of the swf in the page</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.htmlWrapper.width</td><td><code>100%</code></td><td>The width of the swf in the page</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.htmlWrapper.bgcolor</td><td><code>#ffffff</code></td><td>The background color for the page</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.htmlWrapper.version.major</td><td><code>10</code></td><td>The minimum required Flash major version</td></tr><tr class="table-odd"><td>grails.plugin.flex.mxmlc.htmlWrapper.version.minor</td><td><code>0</code></td><td>The minimum required Flash minor version</td></tr><tr class="table-even"><td>grails.plugin.flex.mxmlc.htmlWrapper.version.revision</td><td><code>0</code></td><td>The minimum required Flash revision version</td></tr></table><p class="paragraph"/><h1><a name="3 General Usage">3 General Usage</a></h1><h4>Runtime configuration</h4><p class="paragraph"/>The plugin (with help from the <a href="http://grails.org/plugin/blazeds" target="blank">BlazeDS plugin</a>) manages the configuration of BlazeDS and Flex for you. This includes configuring the webtier mxml compiler and support (<code>flex.webtier.server.j2ee.MxmlServlet</code> and <code>flex.webtier.server.j2ee.SwfServlet</code>) if enabled (true by default in development mode) and the <code>flex.webtier.server.j2ee.ForbiddenServlet</code> which denies access to source code files.<p class="paragraph"/>When you run the <a href="../ref/Scripts/flex-init.html" class="Scripts">flex-init</a> script, initial <code>flex-config.xml</code> and <code>flex-webtier-config.xml</code> configuration files are generated in the <code>/WEB-INF/flex/</code> folder, and required resources from your Flex SDK are also copied there. You can customize all of these but the initial configuration should be sufficient to get started.<p class="paragraph"/><h4>Development mode</h4><p class="paragraph"/>In development mode you can create and edit .mxml and .as files in the web-app folder or subfolders and load the .mxml files in a web browser. They'll get compiled into a .swf file and loaded if it's the first time you've loaded them, or if one of the source files (the top-level .mxml file or any referenced .mxml or .as file) has changed.<p class="paragraph"/><h4>Production mode</h4><p class="paragraph"/>In production mode files are precompiled (like GSPs) so there's no initial compilation lag and performance is maximized. Precompilation is configurable via settings and you can also explicitly compile the files yourself, either with the Scripts script or by using the SDK tools directly.<p class="paragraph"/><h4>Grails services as remote destinations</h4><p class="paragraph"/>As described in the BlazeDS plugin documentation, it's simple to access a Grails service as a remote service from Flex - just annotate the service with the <code>org.springframework.flex.remoting.RemotingDestination</code> annotation. BlazeDS handles invoking method calls and marshalling parameters and return values for you.<p class="paragraph"/>One thing that's important to note is that although there is a <code>services-config.xml</code> configuration file (created when the BlazeDS plugin is installed) you probably won't need to make many changes there. In typical Flex applications you would register remote services using XML, but Grails services are well suited as candidates for remote services.<p class="paragraph"/><h4>Flash Builder integration</h4><p class="paragraph"/>You can easily create Flex-based applications using your IDE or a text editor but using Flash Builder is a lot more convenient. The standard project layout for Flash Builder isn't the same as for Grails though, so you can run the <a href="../ref/Scripts/integrate-with-flash-builder.html" class="Scripts">integrate-with-flash-builder</a> script to update your Eclipse/STS .project file and create .flexProperties and .actionScriptProperties files, all configured with settings that are compatible for both environments.<p class="paragraph"/><h4>Scripts</h4><p class="paragraph"/>You can use the plugins file-generating scripts to help create MXML and ActionScript classes. These include <a href="../ref/Scripts/create-mxml.html" class="Scripts">create-mxml</a> which creates a basic MXML file, <a href="../ref/Scripts/create-actionscript-class.html" class="Scripts">create-actionscript-class</a> which creates a basic ActionScript class, and <a href="../ref/Scripts/generate-actionscript-class.html" class="Scripts">generate-actionscript-class</a> which generates an ActionScript class based on one of your domain classes for use with remote services.<p class="paragraph"/><h4>Manual configuration</h4><p class="paragraph"/>You're not limited to using Grails services as the server-side implementation of remote services. You can use any class like you would in a non-Grails application, and the best place to configure this is in <code>grails-app/conf/spring/resources.groovy</code> using the BeanBuilder syntax equivalent of the Spring Flex XML configuration.<p class="paragraph"/>For example, this resources.groovy file contains four messaging destinations and two remoting destinations. Remoting destinations are configured like any other Spring bean, with the addition of a <code>flex.'remoting-destination'()</code> child element, optionally with configuration options. See the <a href="http://www.springsource.org/spring-flex" target="blank">Spring Flex</a> documentation for more information on what's available.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> flex.management.jmx.MBeanServerGateway<p class="paragraph"/>beans = &#123;<p class="paragraph"/>   xmlns flex: 'http://www.springframework.org/schema/flex'<p class="paragraph"/>   flex.'message&#45;destination'(id: 'chat')
   flex.'message&#45;destination'(id: 'secured&#45;chat', 'send&#45;security&#45;constraint': 'trusted')
   flex.'message&#45;destination'(id: 'simple&#45;feed')
   flex.'message&#45;destination'(id: 'market&#45;feed', 'allow&#45;subtopics': <span class="java&#45;keyword">true</span>, 'subtopic&#45;separator': '.')<p class="paragraph"/>   securityHelper(Security3Helper) &#123;
      flex.'remoting&#45;destination'()
   &#125;<p class="paragraph"/>   RuntimeManagement(MBeanServerGateway) &#123;
      flex.'remoting&#45;destination'(channels: 'my&#45;amf, my&#45;secure&#45;amf')
   &#125;
&#125;</pre></div><p class="paragraph"/><h1><a name="4 Tutorial">4 Tutorial</a></h1><h4>1. Create your Grails application.</h4><p class="paragraph"/><div class="code"><pre>$ grails create&#45;app FlexContacts
$ cd FlexContacts</pre></div><p class="paragraph"/><h4>2. Install the plugin.</h4>
<div class="code"><pre>$ grails install&#45;plugin flex</pre></div><p class="paragraph"/><h4>3. Initialize Spring Security.</h4>
<div class="code"><pre>$ grails s2&#45;quickstart grails.demo.flexcontacts User Role</pre></div><p class="paragraph"/><h4>4. Configure the Flex SDK location.</h4><p class="paragraph"/>If you don't have a <code>FLEX_HOME</code> environment variable set, configure the location of your Flex SDK in <code>grails-app/conf/Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.flex.home = '/path/to/your/flex/sdk'</pre></div><p class="paragraph"/><h4>5. Initialize the Flex plugin.</h4>
<div class="code"><pre>$ grails flex&#45;init</pre></div><p class="paragraph"/><h4>6. Create the Contact domain class.</h4>
<div class="code"><pre>$ grails create&#45;domain&#45;class grails.demo.flexcontacts.Contact</pre></div><p class="paragraph"/>Update the domain class with this code:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> grails.demo.flexcontacts<p class="paragraph"/>class Contact <span class="java&#45;keyword">implements</span> Serializable &#123;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> <span class="java&#45;keyword">final</span> <span class="java&#45;object">long</span> serialVersionUID = 1<p class="paragraph"/>   <span class="java&#45;object">String</span> firstName
   <span class="java&#45;object">String</span> lastName
   <span class="java&#45;object">String</span> address
   <span class="java&#45;object">String</span> city
   <span class="java&#45;object">String</span> state
   <span class="java&#45;object">String</span> zip
   <span class="java&#45;object">String</span> phone
   <span class="java&#45;object">String</span> email<p class="paragraph"/>   <span class="java&#45;keyword">static</span> constraints = &#123;
      firstName size: 1..50, blank: <span class="java&#45;keyword">false</span>
      lastName size: 1..50, blank: <span class="java&#45;keyword">false</span>
      address size: 1..50, blank: <span class="java&#45;keyword">false</span>
      city size: 1..50, blank: <span class="java&#45;keyword">false</span>
      state size: 1..20, blank: <span class="java&#45;keyword">false</span>
      zip size: 1..20, nullable: <span class="java&#45;keyword">true</span>
      phone size: 1..50, nullable: <span class="java&#45;keyword">true</span>
      email size: 1..50, blank: <span class="java&#45;keyword">false</span>
   &#125;<p class="paragraph"/>   <span class="java&#45;keyword">static</span> List&#60;Contact&#62; findByName(<span class="java&#45;object">String</span> name) &#123;
      executeQuery(<span class="java&#45;quote">"from Contact where UPPER(CONCAT(firstName, ' ', lastName)) LIKE :name ORDER BY firstName, lastName"</span>,
         &#91;name: <span class="java&#45;quote">"%"</span> + name.toUpperCase() + <span class="java&#45;quote">"%"</span>&#93;)
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>7. Create the Contact service.</h4>
<div class="code"><pre>$ grails create&#45;service grails.demo.flexcontacts.Contact</pre></div><p class="paragraph"/>Update the service with this code:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> grails.demo.flexcontacts<p class="paragraph"/><span class="java&#45;keyword">import</span> org.springframework.flex.remoting.RemotingDestination<p class="paragraph"/>@RemotingDestination(channels = &#91;'my&#45;amf'&#93;)
class ContactService &#123;<p class="paragraph"/>   List&#60;Contact&#62; findByName(<span class="java&#45;object">String</span> name) &#123;
      Contact.findByName name
   &#125;<p class="paragraph"/>   List&#60;Contact&#62; findAll() &#123;
      Contact.list()
   &#125;<p class="paragraph"/>   Contact findById(<span class="java&#45;object">long</span> id) &#123;
      Contact.get id
   &#125;<p class="paragraph"/>   Contact create(Contact contact) &#123;
      contact.id = <span class="java&#45;keyword">null</span>
      contact.save()
      contact
   &#125;<p class="paragraph"/>   <span class="java&#45;object">boolean</span> update(Contact contact) &#123;
      Contact fromDb = Contact.get(contact.id)
      <span class="java&#45;keyword">if</span> (!fromDb) &#123;
         <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">false</span>
      &#125;
      fromDb.properties = contact.properties
      fromDb.validate() &#38;&#38; fromDb.save()
   &#125;<p class="paragraph"/>   <span class="java&#45;object">boolean</span> remove(Contact contact) &#123;
      Contact.get(contact.id)?.delete()
      <span class="java&#45;keyword">true</span>
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>8. Create the primary MXML file.</h4>
<div class="code"><pre>$ grails create&#45;mxml web&#45;app/Main.mxml</pre></div><p class="paragraph"/>Update the MXML file with this code:<p class="paragraph"/><div class="code"><pre>&#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"utf&#45;8"</span>?&#62;
&#60;mx:Application xmlns:mx=<span class="java&#45;quote">"http://www.adobe.com/2006/mxml"</span> xmlns=<span class="java&#45;quote">"&#42;"</span>&#62;<p class="paragraph"/>   &#60;mx:Script&#62;&#60;!&#91;CDATA&#91;<p class="paragraph"/>      <span class="java&#45;keyword">import</span> mx.rpc.events.FaultEvent;
      <span class="java&#45;keyword">import</span> mx.controls.Alert;
      <span class="java&#45;keyword">import</span> mx.collections.ArrayCollection;
      <span class="java&#45;keyword">import</span> mx.rpc.events.ResultEvent;<p class="paragraph"/>      &#91;Bindable&#93; <span class="java&#45;keyword">private</span> <span class="java&#45;keyword">var</span> contacts:ArrayCollection;<p class="paragraph"/>      <span class="java&#45;keyword">private</span> function resultHandler(event:ResultEvent):void &#123;
         contacts = event.result as ArrayCollection
      &#125;<p class="paragraph"/>      <span class="java&#45;keyword">private</span> function faultHandler(event:FaultEvent):void &#123;
         Alert.show(event.fault.faultDetail);
      &#125;<p class="paragraph"/>      <span class="java&#45;keyword">public</span> function openContact(contact:Contact):void &#123;
         <span class="java&#45;keyword">var</span> children:Array = tn.getChildren();
         <span class="java&#45;keyword">for</span> (<span class="java&#45;keyword">var</span> i:<span class="java&#45;object">int</span> = 0; i&#60;children.length; i++) &#123;
            <span class="java&#45;keyword">if</span> (ContactForm(children&#91;i&#93;).contact.id == contact.id) &#123;
               tn.selectedChild = children&#91;i&#93;;
               <span class="java&#45;keyword">return</span>;
            &#125;
         &#125;<p class="paragraph"/>         <span class="java&#45;keyword">var</span> form:ContactForm = <span class="java&#45;keyword">new</span> ContactForm();
         tn.addChild(form);
         form.contact = contact;
         tn.selectedChild = form;
      &#125;
   &#93;&#93;&#62;&#60;/mx:Script&#62;<p class="paragraph"/>   &#60;mx:RemoteObject id=<span class="java&#45;quote">"ro"</span> destination=<span class="java&#45;quote">"contactService"</span> fault=<span class="java&#45;quote">"faultHandler(event)"</span>&#62;
      &#60;mx:method name=<span class="java&#45;quote">"findByName"</span> result=<span class="java&#45;quote">"resultHandler(event)"</span>/&#62;
   &#60;/mx:RemoteObject&#62;<p class="paragraph"/>   &#60;mx:ApplicationControlBar width=<span class="java&#45;quote">"100%"</span>&#62;
      &#60;mx:TextInput id=<span class="java&#45;quote">"searchStr"</span>/&#62;
      &#60;mx:Button label=<span class="java&#45;quote">"Search"</span> click=<span class="java&#45;quote">"ro.findByName(searchStr.text)"</span>/&#62;
      &#60;mx:Button label=<span class="java&#45;quote">"New Contact"</span> click=<span class="java&#45;quote">"openContact(<span class="java&#45;keyword">new</span> Contact())"</span>/&#62;
   &#60;/mx:ApplicationControlBar&#62;<p class="paragraph"/>   &#60;mx:HDividedBox width=<span class="java&#45;quote">"100%"</span> height=<span class="java&#45;quote">"100%"</span>&#62;
      &#60;mx:DataGrid id=<span class="java&#45;quote">"dg"</span> dataProvider=<span class="java&#45;quote">"&#123;contacts&#125;"</span> width=<span class="java&#45;quote">"30%"</span> height=<span class="java&#45;quote">"100%"</span>
         doubleClickEnabled=<span class="java&#45;quote">"<span class="java&#45;keyword">true</span>"</span>
         doubleClick=<span class="java&#45;quote">"openContact(dg.selectedItem as Contact)"</span>&#62;
         &#60;mx:columns&#62;
            &#60;mx:DataGridColumn dataField=<span class="java&#45;quote">"firstName"</span> headerText=<span class="java&#45;quote">"First Name"</span>/&#62;
            &#60;mx:DataGridColumn dataField=<span class="java&#45;quote">"lastName"</span> headerText=<span class="java&#45;quote">"Last Name"</span>/&#62;
         &#60;/mx:columns&#62;
      &#60;/mx:DataGrid&#62;
      &#60;mx:TabNavigator id=<span class="java&#45;quote">"tn"</span> width=<span class="java&#45;quote">"70%"</span> height=<span class="java&#45;quote">"100%"</span>/&#62;
   &#60;/mx:HDividedBox&#62;<p class="paragraph"/>&#60;/mx:Application&#62;</pre></div><p class="paragraph"/><h4>9. Create the contact form MXML file.</h4>
<div class="code"><pre>$ grails create&#45;mxml web&#45;app/ContactForm.mxml</pre></div><p class="paragraph"/>Update the MXML file with this code:<p class="paragraph"/><div class="code"><pre>&#60;?xml version=<span class="java&#45;quote">"1.0"</span> encoding=<span class="java&#45;quote">"utf&#45;8"</span>?&#62;
&#60;mx:Canvas xmlns:mx=<span class="java&#45;quote">"http://www.adobe.com/2006/mxml"</span> width=<span class="java&#45;quote">"100%"</span> height=<span class="java&#45;quote">"100%"</span>
   backgroundColor=<span class="java&#45;quote">"&#35;FFFFFF"</span>
   label=<span class="java&#45;quote">"&#123;contact.id&#62;0?contact.firstName+' '+contact.lastName:'New Contact'&#125;"</span>&#62;<p class="paragraph"/>   &#60;mx:Script&#62;&#60;!&#91;CDATA&#91;<p class="paragraph"/>      <span class="java&#45;keyword">import</span> mx.rpc.events.FaultEvent;
      <span class="java&#45;keyword">import</span> mx.rpc.events.ResultEvent;
      <span class="java&#45;keyword">import</span> mx.controls.Alert;<p class="paragraph"/>      &#91;Bindable&#93; <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> contact:Contact;<p class="paragraph"/>      <span class="java&#45;keyword">private</span> function save():void &#123;
         contact.firstName = firstName.text;
         contact.lastName = lastName.text;
         contact.email = email.text;
         contact.phone = phone.text;
         contact.address = address.text;
         contact.city = city.text;
         contact.state = state.text;
         contact.zip = zip.text;
         <span class="java&#45;keyword">if</span> (contact.id == 0) &#123;
            ro.create(contact);
         &#125;
         <span class="java&#45;keyword">else</span> &#123;
            ro.update(contact);
         &#125;
      &#125;<p class="paragraph"/>      <span class="java&#45;keyword">private</span> function create_resultHandler(event:ResultEvent):void &#123;
         contact.id = event.result.id;
      &#125;<p class="paragraph"/>      <span class="java&#45;keyword">private</span> function deleteItem():void &#123;
         ro.remove(contact);
      &#125;<p class="paragraph"/>      <span class="java&#45;keyword">private</span> function remove_resultHandler(event:ResultEvent):void &#123;
         parent.removeChild(<span class="java&#45;keyword">this</span>);
      &#125;<p class="paragraph"/>      <span class="java&#45;keyword">private</span> function faultHandler(event:FaultEvent):void &#123;
         Alert.show(event.fault.faultDetail);
      &#125;
   &#93;&#93;&#62;&#60;/mx:Script&#62;<p class="paragraph"/>   &#60;mx:RemoteObject id=<span class="java&#45;quote">"ro"</span> destination=<span class="java&#45;quote">"contactService"</span>&#62;
      &#60;mx:method name=<span class="java&#45;quote">"create"</span> result=<span class="java&#45;quote">"create_resultHandler(event)"</span>/&#62;
      &#60;mx:method name=<span class="java&#45;quote">"remove"</span> result=<span class="java&#45;quote">"remove_resultHandler(event)"</span>/&#62;
   &#60;/mx:RemoteObject&#62;<p class="paragraph"/>   &#60;mx:Form&#62;
      &#60;mx:FormItem label=<span class="java&#45;quote">"Id"</span>&#62;
         &#60;mx:TextInput text=<span class="java&#45;quote">"&#123;contact.id&#125;"</span> enabled=<span class="java&#45;quote">"<span class="java&#45;keyword">false</span>"</span>/&#62;
      &#60;/mx:FormItem&#62;
      &#60;mx:FormItem label=<span class="java&#45;quote">"First Name"</span>&#62;
         &#60;mx:TextInput id=<span class="java&#45;quote">"firstName"</span> text=<span class="java&#45;quote">"&#123;contact.firstName&#125;"</span>/&#62;
      &#60;/mx:FormItem&#62;
      &#60;mx:FormItem label=<span class="java&#45;quote">"Last Name"</span>&#62;
         &#60;mx:TextInput id=<span class="java&#45;quote">"lastName"</span> text=<span class="java&#45;quote">"&#123;contact.lastName&#125;"</span>/&#62;
      &#60;/mx:FormItem&#62;
      &#60;mx:FormItem label=<span class="java&#45;quote">"Email"</span>&#62;
         &#60;mx:TextInput id=<span class="java&#45;quote">"email"</span> text=<span class="java&#45;quote">"&#123;contact.email&#125;"</span>/&#62;
      &#60;/mx:FormItem&#62;
      &#60;mx:FormItem label=<span class="java&#45;quote">"Phone"</span>&#62;
         &#60;mx:TextInput id=<span class="java&#45;quote">"phone"</span> text=<span class="java&#45;quote">"&#123;contact.phone&#125;"</span>/&#62;
      &#60;/mx:FormItem&#62;
      &#60;mx:FormItem label=<span class="java&#45;quote">"Address"</span>&#62;
         &#60;mx:TextInput id=<span class="java&#45;quote">"address"</span> text=<span class="java&#45;quote">"&#123;contact.address&#125;"</span>/&#62;
      &#60;/mx:FormItem&#62;
      &#60;mx:FormItem label=<span class="java&#45;quote">"City"</span>&#62;
         &#60;mx:TextInput id=<span class="java&#45;quote">"city"</span> text=<span class="java&#45;quote">"&#123;contact.city&#125;"</span>/&#62;
      &#60;/mx:FormItem&#62;
      &#60;mx:FormItem label=<span class="java&#45;quote">"State"</span>&#62;
         &#60;mx:TextInput id=<span class="java&#45;quote">"state"</span> text=<span class="java&#45;quote">"&#123;contact.state&#125;"</span>/&#62;
      &#60;/mx:FormItem&#62;
      &#60;mx:FormItem label=<span class="java&#45;quote">"Zip"</span>&#62;
         &#60;mx:TextInput id=<span class="java&#45;quote">"zip"</span> text=<span class="java&#45;quote">"&#123;contact.zip&#125;"</span>/&#62;
      &#60;/mx:FormItem&#62;
   &#60;/mx:Form&#62;<p class="paragraph"/>   &#60;mx:HBox left=<span class="java&#45;quote">"8"</span> bottom=<span class="java&#45;quote">"8"</span>&#62;
      &#60;mx:Button label=<span class="java&#45;quote">"Close"</span> click=<span class="java&#45;quote">"parent.removeChild(<span class="java&#45;keyword">this</span>)"</span>/&#62;
      &#60;mx:Button label=<span class="java&#45;quote">"Save"</span> click=<span class="java&#45;quote">"save()"</span>/&#62;
      &#60;mx:Button label=<span class="java&#45;quote">"Delete"</span> click=<span class="java&#45;quote">"deleteItem()"</span>/&#62;
   &#60;/mx:HBox&#62;<p class="paragraph"/>&#60;/mx:Canvas&#62;</pre></div><p class="paragraph"/><h4>10. Generate the Contact ActionScript class.</h4>
<div class="code"><pre>$ grails generate&#45;actionscript&#45;class Contact grails.demo.flexcontacts.Contact</pre></div><p class="paragraph"/>That will create this ActionScript class:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span>  &#123;<p class="paragraph"/>   &#91;Bindable&#93;
   &#91;RemoteClass(alias='grails.demo.flexcontacts.Contact')&#93;
   <span class="java&#45;keyword">public</span> class Contact &#123;
      <span class="java&#45;keyword">public</span> function Contact() &#123;
         // constructor
      &#125;<p class="paragraph"/>      <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> id:<span class="java&#45;object">int</span>;
      <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> address:<span class="java&#45;object">String</span>;
      <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> city:<span class="java&#45;object">String</span>;
      <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> email:<span class="java&#45;object">String</span>;
      <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> firstName:<span class="java&#45;object">String</span>;
      <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> lastName:<span class="java&#45;object">String</span>;
      <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> phone:<span class="java&#45;object">String</span>;
      <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> state:<span class="java&#45;object">String</span>;
      <span class="java&#45;keyword">public</span> <span class="java&#45;keyword">var</span> zip:<span class="java&#45;object">String</span>;
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>11. Edit grails-app/conf/BootStrap.groovy and add some test data.</h4><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.demo.flexcontacts.Contact<p class="paragraph"/>class BootStrap &#123;<p class="paragraph"/>   def sessionFactory<p class="paragraph"/>   def init = &#123; servletContext &#45;&#62;
      createContacts()
      sessionFactory.currentSession.flush()
   &#125;<p class="paragraph"/>   <span class="java&#45;keyword">private</span> void createContacts() &#123;
      <span class="java&#45;keyword">if</span> (Contact.count()) &#123;
         println 'Contacts already exist'
      &#125;
      <span class="java&#45;keyword">else</span> &#123;
         println 'Inserting sample data in table CONTACT...'
         createContact 'Christophe', 'Coenraets', '275 Grove St', 'Newton', 'MA', '02476', '617&#45;219&#45;2000', 'ccoenrae@adobe.com'
         createContact 'John', 'Smith', '1 Main st', 'Boston', 'MA', '01744', '617&#45;219&#45;2001', 'jsmith@mail.com'
         createContact 'Lisa', 'Taylor', '501 Townsend st', 'San Francisco', 'CA', '', '415&#45;534&#45;7865', 'ltaylor@mail.com'
         createContact 'Noah', 'Jones', '1200 5th Avenue ', 'New York', 'NY', '', '212&#45;764&#45;2345', 'njones@mail.com'
         createContact 'Bill', 'Johnson', '1345 6th street', 'Chicago', 'IL', '', '', 'bjohnson@mail.com'
         createContact 'Chloe', 'Rodriguez', '34 Elm street', 'Dallas', 'TX', '', '415&#45;534&#45;7865', 'crodriguez@mail.com'
         createContact 'Jorge', 'Espinosa', '23 Putnam Avenue', 'Seattle', 'WA', '', '', 'jespinosa@mail.com'
         createContact 'Amy', 'King', '11 Summer st', 'Miami', 'FL', '', '', 'aking@mail.com'
         createContact 'Boris', 'Jefferson', '222 Spring st', 'Denver', 'CO', '', '415&#45;534&#45;7865', 'bjefferson@mail.com'
         createContact 'Linda', 'Madison', '564 Winter st', 'Washington', 'DC', '', '', 'lmadison@mail.com'
      &#125;
   &#125;<p class="paragraph"/>   <span class="java&#45;keyword">private</span> void createContact(<span class="java&#45;object">String</span> firstName, <span class="java&#45;object">String</span> lastName, <span class="java&#45;object">String</span> address, <span class="java&#45;object">String</span> city,
         <span class="java&#45;object">String</span> state, <span class="java&#45;object">String</span> zip, <span class="java&#45;object">String</span> phone, <span class="java&#45;object">String</span> email) &#123;
      <span class="java&#45;keyword">new</span> Contact(firstName: firstName, lastName: lastName, address: address, city: city,
            state: state, zip: zip, phone: phone, email: email).save(failOnError: <span class="java&#45;keyword">true</span>)
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>12. Start the server.</h4>
<div class="code"><pre>$ grails run&#45;app</pre></div><p class="paragraph"/><h4>13. Navigate to <a href="http://localhost:8080/FlexContacts/Main.mxml" target="blank">http://localhost:8080/FlexContacts/Main.mxml</a>.</h4><p class="paragraph"/>The Flash page should load after the webtier mxmlc compiler compiles the swf.<p class="paragraph"/><h4>14. Experiment with the application.</h4>
<ul class="star">
<li>if you leave the search box empty all users will be returned</li>
<li>you can also search by full or partial name</li>
<li>double-clicking a name in the result list displays the edit form for that person</li>
<li>making changes to a person's contact data should update the search results</li>
<li>creating or deleting a contact doesn't update the search results - re-run the search to refresh</li>
<li>you can sort the results by clicking the First Name and Last Name column headers</li>
</ul><p class="paragraph"/><h4>15. Verify that ActionScript isn't browseable.</h4><p class="paragraph"/>Attempt to open <a href="http://localhost:8080/FlexContacts/Contact.as" target="blank">http://localhost:8080/FlexContacts/Contact.as</a> in a browser - you should get a 403 error page even though it's in the web-app folder and .mxml files load. This is because ActionScript files are explicitly blocked, as are .mxml files in production mode (which we'll see in a bit).<p class="paragraph"/><h4>16. Build and deploy a war file.</h4><p class="paragraph"/>Shut down the development mode application (using CTRL-C).<p class="paragraph"/>Configure precompilation in <code>grails-app/conf/Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.plugin.flex.precompileMxml.enabled = <span class="java&#45;keyword">true</span>
grails.plugin.flex.precompileMxml.files = &#91;'Main.mxml'&#93;
grails.plugin.flex.precompileMxml.htmlWrapper.create = <span class="java&#45;keyword">true</span>
grails.plugin.flex.mxmlc.contextRoot = 'FlexContacts'</pre></div><p class="paragraph"/>The last line configuring the <code>contextRoot</code> attribute is required since <code>run-war</code> deploys with the same context as in development, but in general this should be configured with the actual value of the context root.<p class="paragraph"/>Start the app using a war in production mode:<p class="paragraph"/><div class="code"><pre>$ grails prod run&#45;war</pre></div><p class="paragraph"/>Note that the output indicates that Main.mxml gets precompiled and that a GSP wrapper is created for it:<p class="paragraph"/><div class="code"><pre>&#91;echo&#93; Precompiling MXML Main.mxml
 . . .
&#91;echo&#93; Generating Main.gsp</pre></div><p class="paragraph"/><h4>17. Navigate to <a href="http://localhost:8080/FlexContacts/Main.gsp" target="blank">http://localhost:8080/FlexContacts/Main.gsp</a>.</h4><p class="paragraph"/>The Flash page should load very quickly since the swf is already compiled. The functionality should be the same as before when testing with Main.mxml.<p class="paragraph"/><h4>18. Verify that ActionScript and MXML aren't browseable in production mode.</h4><p class="paragraph"/>Attempt to open <a href="http://localhost:8080/FlexContacts/Contact.as" target="blank">http://localhost:8080/FlexContacts/Contact.as</a> in a browser - you should get a 403 error page even though it's in the web-app folder. Also attempt to open <a href="http://localhost:8080/FlexContacts/Main.mxml" target="blank">http://localhost:8080/FlexContacts/Main.mxml</a> in a browser - you should get a 403 for that too. This is because ActionScript and MXML files are explicitly blocked in production mode - only .swf files can be loaded.<p class="paragraph"/>

        </div>
        <div id="footer">
             
        </div>
    
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16219500-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</body>
</html>
